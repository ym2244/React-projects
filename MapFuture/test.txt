下面是对你需求的整理和总结：

1. **“Generate” 按钮行为**

   * 重新生成 **整个** 行程计划
   * 切换回第 1 天的界面
   * 清空前端维护的 `Approved_Cities` 数组（已批准城市）which will be send in the post request body

2. **“Regenerate” 按钮行为**

   * 只重新生成 **当前** 那一天的行程
   * 保留之前各天已批准的城市，即不清空 `Approved_Cities` 数组
   * 不切换回第 1 天，保持在当前天的视图

3. **展示地图标记（add markers）时机**

   * 等用户对 **所有** 天的计划都 “Confirm” 后，才把 `Approved_Cities` 发送给真正渲染地图标记的步骤
   * 在逐天确认过程中，不执行最终的地图更新

4. **“Regenerate” 不切换页面**

   * 点击 Regenerate 时，仅刷新当前 `currentDay` 的数据
   * 保留 `activeDay`（当前页）不变，不跳回 Day 1

5. **按钮逻辑分离**

   * **GenerateButton**：

     * 全量生成：清空 `Approved_Cities`，重置 `activeDay = 0`（Day 1），重建完整 `planDays`
   * **RegenerateButton**：

     * 局部更新：只请求并更新 `planDays[activeDay]`，不动 `Approved_Cities`、不重置 `activeDay`

6. **最后一天也需“Confirm”**

   * 如果总天数为 N，Day N 点击“Generate”或“Regenerate”后，不要自动跳过“Confirm”步骤
   * 在 Day N 显示“Confirm”按钮，用户点击后才算完成

7. **“All done” 状态**

   * 当 **所有** 天（包含最后一天）都被用户点击 “Confirm” 之后，切换到一个 “All done” 界面或状态提示

8. **统一发送更新到地图**

   * 在进入 “All done” 后，拿到 **最新一次** 的 `Approved_Cities` 数组（共 N 个城市）
   * 对这 N 个城市依次调用 `createCity(...)`，在地图上打钉


这样一来，“Generate” 用于全量重置，“Regenerate” 用于局部刷新，地图渲染则在所有天都确认后统一触发，所有功能都和prompt的期望一致。

